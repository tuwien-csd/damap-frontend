<mat-vertical-stepper
  class="verticalStepper"
  #stepper
  [linear]="false"
  (selectionChange)="changeStep($event); changeStepPosition($event)">
  <ng-template matStepperIcon="done" let-index="index">
    <mat-icon
      class="material-icon-white-background-success custom-icon-step"
      *ngIf="iconsValidatorDone(index, 'check')"
      >check</mat-icon
    >
    <mat-icon
      class="material-icon-white-background-primary custom-icon-step"
      *ngIf="iconsValidatorDone(index, 'edit')"
      >edit</mat-icon
    >
    <mat-icon
      class="material-icon-white-background-gray-color custom-icon-step"
      *ngIf="iconsValidatorDone(index, 'lock')"
      >lock</mat-icon
    >

    <mat-icon
      class="material-icon-white-background-success custom-icon-step"
      *ngIf="iconsValidatorDone(index, 'text_snippet')">
      text_snippet
    </mat-icon>
  </ng-template>

  <ng-template matStepperIcon="edit" let-index="index">
    <mat-icon
      class="custom-icon-step"
      *ngIf="iconsValidatorEdit(index, 'text_snippet')">
      text_snippet
    </mat-icon>

    <mat-icon
      class="material-icon-white-background-primary custom-icon-step"
      *ngIf="iconsValidatorEdit(index, 'edit')">
      edit
    </mat-icon>

    <mat-icon
      class="material-icon-white-background-primary custom-icon-step"
      *ngIf="iconsValidatorEdit(index, 'lock')"
      >lock</mat-icon
    >
  </ng-template>

  <ng-template matStepperIcon="number" let-index="index">
    <mat-icon
      class="custom-icon-step number-step-icon"
      *ngIf="iconsValidatorNumber(index, 'number', stepper.selectedIndex)">
      {{ index + 1 }}
    </mat-icon>

    <mat-icon
      class="material-icon-white-background-primary custom-icon-step"
      *ngIf="iconsValidatorNumber(index, 'edit', stepper.selectedIndex)">
      edit
    </mat-icon>

    <mat-icon
      class="custom-icon-step"
      *ngIf="
        iconsValidatorNumber(
          index,
          'text_snippet',
          stepper.selectedIndex,
          'gray'
        )
      ">
      text_snippet
    </mat-icon>

    <mat-icon
      class="material-icon-white-background-success custom-icon-step"
      *ngIf="
        iconsValidatorNumber(
          index,
          'text_snippet',
          stepper.selectedIndex,
          'success'
        )
      ">
      text_snippet
    </mat-icon>

    <mat-icon
      class="material-icon-white-background-gray-color custom-icon-step"
      *ngIf="iconsValidatorNumber(index, 'lock', stepper.selectedIndex)"
      >lock</mat-icon
    >
  </ng-template>

  <mat-step
    label="{{ 'dmp.steps.project.label' | translate }}"
    [completed]="
      completenessLabel('dmp.steps.project.label')?.completeness === 100
    ">
    <app-dmp-project
      [projectStep]="projectStep"
      (project)="changeProject($event)"></app-dmp-project>
  </mat-step>
  <mat-step
    label="{{ 'dmp.steps.people.label' | translate }}"
    [completed]="completenessLabel('dmp.steps.people.label')?.completeness > 0">
    <app-dmp-people
      [config$]="config$"
      [projectMembers]="projectMembers"
      [dmpForm]="dmpForm"
      (contactPerson)="changeContactPerson($event)"
      (contributorToAdd)="addContributor($event)"
      (contributorToRemove)="removeContributor($event)">
    </app-dmp-people>
  </mat-step>
  <mat-step
    label="{{ 'dmp.steps.data.specify.label' | translate }}"
    [completed]="
      completenessLabel('dmp.steps.data.specify.label')?.completeness > 0
    "
    [hasError]="specifyDataStep.invalid || datasets.invalid">
    <app-dmp-specify-data
      [config$]="config$"
      [specifyDataStep]="specifyDataStep"
      [datasets]="datasets"
      [fileUpload]="fileUpload"
      (datasetToAdd)="addDataset($event)"
      (updateDataset)="updateDataset($event)"
      (fileToAnalyse)="analyseFile($event)"
      (uploadToCancel)="cancelFileUpload($event)"
      (removeDataset)="removeDataset($event)">
    </app-dmp-specify-data>
  </mat-step>
  <mat-step
    label="{{ 'dmp.steps.documentation.label' | translate }}"
    [completed]="
      completenessLabel('dmp.steps.documentation.label')?.completeness > 0
    "
    [hasError]="docDataStep.invalid">
    <ng-container *ngIf="showStep; else noDatasets">
      <app-dmp-doc-data-quality
        [docDataStep]="docDataStep"></app-dmp-doc-data-quality>
    </ng-container>
  </mat-step>
  <mat-step
    label="{{ 'dmp.steps.storage.label' | translate }}"
    [completed]="completenessLabel('dmp.steps.storage.label')?.completeness > 0"
    [hasError]="
      storageStep.invalid ||
      externalStorageStep.invalid ||
      externalStorageInfo.invalid
    ">
    <ng-container *ngIf="showStep; else noDatasets">
      <div class="intro-step">
        <app-step-intro>
          {{ "dmp.steps.data.specify.tab.introStorage" | translate }}
        </app-step-intro>
      </div>
      <mat-tab-group dynamicHeight animationDuration="0ms">
        <mat-tab label="{{ 'dmp.steps.data.specify.tab.access' | translate }}">
          <app-data-access [dmpForm]="dmpForm" [datasets]="datasets">
          </app-data-access>
        </mat-tab>
        <mat-tab label="{{ 'dmp.steps.data.specify.tab.storage' | translate }}">
          <app-dmp-storage
            [dmpForm]="dmpForm"
            [storageStep]="storageStep"
            [datasets]="datasets"
            (storageToAdd)="addStorage($event)"
            (storageToRemove)="removeStorage($event)">
          </app-dmp-storage>
          <app-dmp-external-storage
            [externalStorageStep]="externalStorageStep"
            [externalStorageInfo]="externalStorageInfo"
            [datasets]="datasets"
            (externalStorageToAdd)="addExternalStorage()"
            (externalStorageToRemove)="removeExternalStorage($event)">
          </app-dmp-external-storage>
        </mat-tab>
      </mat-tab-group>
    </ng-container>
  </mat-step>
  <mat-step
    label="{{ 'dmp.steps.legal.label' | translate }}"
    [completed]="completenessLabel('dmp.steps.legal.label')?.completeness > 0"
    [hasError]="legalEthicalStep.invalid">
    <ng-container *ngIf="showStep; else noDatasets">
      <app-dmp-legal-ethical-aspects
        [dmpForm]="dmpForm"
        [legalEthicalStep]="legalEthicalStep"
        [datasets]="datasets">
      </app-dmp-legal-ethical-aspects>
    </ng-container>
  </mat-step>
  <mat-step
    label="{{ 'dmp.steps.licensing.label' | translate }}"
    [completed]="
      completenessLabel('dmp.steps.licensing.label')?.completeness > 0
    "
    [hasError]="datasets.invalid">
    <ng-container *ngIf="showStepIfNewDatasets; else noDatasets">
      <app-dmp-licenses [dmpForm]="dmpForm" [datasets]="datasets">
      </app-dmp-licenses>
    </ng-container>
  </mat-step>
  <mat-step
    label="{{ 'dmp.steps.repositories.label' | translate }}"
    [completed]="
      completenessLabel('dmp.steps.repositories.label')?.completeness > 0
    "
    [hasError]="repoStep.invalid">
    <ng-container *ngIf="showStepIfNewDatasets; else noDatasets">
      <app-dmp-repo
        [dmpForm]="dmpForm"
        [repoStep]="repoStep"
        [datasets]="datasets"
        (repositoryToAdd)="addRepository($event)"
        (repositoryToRemove)="removeRepository($event)">
      </app-dmp-repo>
    </ng-container>
  </mat-step>
  <mat-step
    label="{{ 'dmp.steps.data.reuse.label' | translate }}"
    [completed]="
      completenessLabel('dmp.steps.data.reuse.label')?.completeness > 0
    "
    [hasError]="reuseStep.invalid">
    <ng-container *ngIf="showStep; else noDatasets">
      <app-dmp-reuse [reuseStep]="reuseStep" [datasets]="datasets">
      </app-dmp-reuse>
    </ng-container>
  </mat-step>
  <mat-step
    label="{{ 'dmp.steps.costs.label' | translate }}"
    [completed]="completenessLabel('dmp.steps.costs.label')?.completeness > 0"
    [hasError]="costsStep.invalid">
    <ng-container *ngIf="showStep; else noDatasets">
      <app-dmp-costs
        [costsStep]="costsStep"
        (costToAdd)="addCost()"
        (costToRemove)="removeCost($event)">
      </app-dmp-costs>
    </ng-container>
  </mat-step>
  <mat-step
    label="{{ 'dmp.steps.end.label' | translate }}"
    [completed]="checkCompletenessForm() === 'completed'">
    <app-dmp-summary [stepper]="stepper"></app-dmp-summary>
  </mat-step>
</mat-vertical-stepper>

<ng-template #noDatasets>
  {{ "dmp.nodatasets" | translate }}
</ng-template>

<app-actions class="dmp-actions" [stepChanged$]="stepChanged$" [admin]="admin">
</app-actions>
